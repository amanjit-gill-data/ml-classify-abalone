---
title: "Classification and Pricing of Farmed Abalone"
author: "Amanjit Gill"
date: "2022-12-05"
output: 
    html_notebook:
        theme: flatly
---

```{css echo=FALSE}

h1, h2, h3 {
    font-weight: bold;
}

h1.title {
    font-size: 2em;
}

h2 {
    font-size: 1.5em;
}

h3 {
    font-size: 1.2em;
}

```


## 1. Exploratory Analysis

```{r setup, message=FALSE}

library(here)
library(dplyr)
library(MVN)

par(
    family = "serif",
    ps = 11,
    mar = c(4.5, 1, 2, 1)
)

params <- par(no.readonly = TRUE)

abalone <- read.csv("abalone.csv")
```

### 1.1 Summary statistics

Statistical summary for each numerical variable.
```{r summary}

summary(abalone.num)

```

RESULTS:

none of the maximum values appear to be out of range, according to sources. however:

min height = 0 (impossible). remove immediately.

```{r}
abalone <- abalone %>% filter(Height > 0)
```


all the minimum weights are between 0.1 and 0.4 grams. not sure how realistic it is to catch and measure an abalone that tiny. needs exploration of outliers.

Check for missing values.
```{r missing values}

nrow(abalone)
sum(complete.cases(abalone))
```

RESULT: No missing values; all rows are complete.

### 1.2 Univariate outliers

```{r outliers}

abalone.num <- abalone %>% select(-Sex)

pdf("1.2.pdf")
par(params)
par("mfrow"=c(4,2))

cols <- colnames(abalone.num)

outliers <- c()

for (c in cols) {
    b <- boxplot(abalone.num[,c], horizontal = TRUE, xlab = c)
    outliers <- c(outliers, length(b$out))
}

outliers <- data.frame(cols, outliers, row.names = cols)
```

RESULTS: 

every numerical variable has some outliers.
however, for 7 of them, the number of outliers is between 0.5 and 1.5% of the sample size, so it's not clear that they will affect the analysis.
for the 8th, Rings, there are 278 outliers, 6.7% of the sample size. This may be impactful, and should be confirmed as being so.

we will not remedy the outliers here. we will try transformations first, to see if some of outliers have been pulled in.

### 1.3 Linearity and homoscedasticity

```{r linearity}
pdf("1.3.pdf")
par(params)

pairs(abalone.num)
```

RESULTS:

non-linear between all the weights and the length and diameter

heteroscedasticity between rings and everything except for height

oval shape implies univariate normality of whole, shucked and viscera weights
others are too hard to tell


### 1.4 Normality

```{r normality}

density_charts <- function(data, colnames, pars, outfile) {
    pdf(outfile)
    par(pars)
    gridrows <- ceiling(length(colnames)/2)
    par("mfrow"=c(gridrows, 2))

    for (c in colnames) {
        plot(density(data[,c]), xlab=c)
    }
}

density_charts(abalone, cols, params, "1.4.pdf")

```

Mardia's skewness and kurtosis test
```{r mardia}

mvn_test <- mvn(abalone.num, mvnTest = "mardia", univariateTest = "SW")

```

### 1.5 Transformations

moderately different from normal: square root

substantially different from normal: logarithm

extremely different from normal: inverse


apply following transformations:

|Variable|Transformation|
|:--------|:--------------|
|Length|Reflect and square root|
|Diameter|Reflect and square root|
|Height|Logarithm|
|Whole weight|Square root|
|Shucked weight|Square root|
|Viscera weight|Square root|
|Shell weight|Square root|
|Rings|Square root|


```{r}

reflect <- function(vals) {
    maxval <- max(vals)
    maxval+1 - vals
}


abalone.num.t <- abalone.num %>% mutate(
    Length = sqrt(reflect(Length)),
    Diameter = sqrt(reflect(Diameter)),
    Height = log(Height),
    Whole.weight = sqrt(Whole.weight),
    Shucked.weight = sqrt(Shucked.weight),
    Viscera.weight = sqrt(Viscera.weight),
    Shell.weight = sqrt(Shell.weight),
    Rings = sqrt(Rings),
    .keep = "unused"
)

```

recheck normality
```{r}

density_charts(abalone.num.t, cols, params, "1.5.pdf")
mvn_test.t <- mvn(abalone.num.t, mvnTest = "mardia", univariateTest = "SW")
```

still fails all tests, but this is because the tests are more likely to fail at larger N for small deviations. visually, they look mostly normal, which matters more than the hyp test.

much improved skewness - very small compared to original data

for kurtosis, most variables have gone from slightly positive (too peaked) to slightly negative (too flat), but the magnitudes are 1 or below, with the exception of Height, which has experienced a marked improvement (from 76.62 to 4.57).

kurtosis generally does not affect estimates of variance for large sample sizes, so these transformations are considered acceptable.

table comparing original skewness and new skewness
```{r}
skew <- data.frame(mvn_test$Descriptives$Skew, mvn_test.t$Descriptives$Skew)
skew[,"Ratio"] <- abs(skew[,2]/skew[,1])

```

table comparing original kurtosis and new kurtosis
```{r}
kurt <- data.frame(mvn_test$Descriptives$Kurtosis, mvn_test.t$Descriptives$Kurtosis)
kurt[,"Ratio"] <- abs(kurt[,2]/kurt[,1])
```


1.6 Removal of outliers

first recheck how many outliers remain after transformation.






